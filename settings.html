<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings ‚Äì Calm Hub</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px 12px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      transition: background-image 0.5s ease;
      position: relative;
    }

    body[data-theme="light"] {
      background-image: url("image.jpg");
    }

    body[data-theme="night"] {
      background-image: url("night.jpg");
    }

    body[data-theme="ocean"] {
      background-image: url("ocean.jpg");
    }

    body[data-theme="forest"] {
      background-image: url("forest.jpg");
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      pointer-events: none;
      z-index: 0;
    }

    body.high-contrast::before {
      background: rgba(0, 0, 0, 0.6);
    }

    body.reduce-motion * {
      animation: none !important;
      transition: none !important;
    }

    .container {
      width: 100%;
      max-width: 1100px;
      margin-top: 20px;
      position: relative;
      z-index: 1;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .back-link a {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .back-link a:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateX(-6px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }

    .quick-actions {
      display: flex;
      gap: 12px;
    }

    .quick-btn {
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 14px;
      color: white;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .quick-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .header {
      text-align: center;
      margin-bottom: 36px;
      padding: 32px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 28px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
    }

    .header h1 {
      font-size: 2.8rem;
      font-weight: 800;
      color: white;
      margin-bottom: 12px;
      letter-spacing: -1px;
      text-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.95);
      font-weight: 500;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 24px;
      margin-bottom: 28px;
    }

    .settings-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 24px;
      padding: 32px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
      transition: all 0.4s ease;
    }

    .settings-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 56px rgba(0, 0, 0, 0.3);
      background: rgba(255, 255, 255, 0.2);
    }

    .card-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 18px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .setting-item {
      margin-bottom: 20px;
    }

    .setting-item:last-child {
      margin-bottom: 0;
    }

    .setting-label {
      font-weight: 600;
      font-size: 1rem;
      color: white;
      margin-bottom: 10px;
      display: block;
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    }

    .setting-sublabel {
      font-size: 0.88rem;
      color: rgba(255, 255, 255, 0.85);
      margin-bottom: 12px;
      display: block;
      line-height: 1.4;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      transition: all 0.3s ease;
      margin-bottom: 14px;
    }

    .toggle-row:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.35);
      transform: translateX(4px);
    }

    .toggle-info {
      flex: 1;
    }

    .toggle-name {
      font-weight: 600;
      font-size: 1rem;
      color: white;
      margin-bottom: 5px;
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    }

    .toggle-desc {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.8);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch {
      position: relative;
      width: 54px;
      height: 30px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 34px;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid rgba(255, 255, 255, 0.3);
      flex-shrink: 0;
    }

    .toggle-switch.active {
      background: rgba(16, 185, 129, 0.8);
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow: 0 0 16px rgba(16, 185, 129, 0.5);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      top: 1px;
      left: 2px;
      transition: transform 0.3s;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    }

    .toggle-switch.active::after {
      transform: translateX(24px);
    }

    .input-field {
      padding: 14px 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 14px;
      font-size: 1rem;
      width: 100%;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .input-field:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.15);
    }

    .input-field::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .select-field {
      padding: 14px 18px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 14px;
      font-size: 1rem;
      width: 100%;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      font-weight: 500;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .select-field:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.15);
    }

    .select-field option {
      background: #1a1a2e;
      color: white;
      padding: 12px;
    }

    .theme-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .theme-option {
      padding: 20px;
      border-radius: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-size: 1.05rem;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .theme-option:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .theme-option.active {
      background: rgba(255, 255, 255, 0.3);
      border-color: white;
      border-width: 3px;
      box-shadow: 0 8px 32px rgba(255, 255, 255, 0.4);
      transform: scale(1.05);
    }

    .btn {
      background: white;
      color: #667eea;
      border: none;
      padding: 16px 32px;
      border-radius: 16px;
      cursor: pointer;
      font-size: 1.05rem;
      font-weight: 700;
      transition: all 0.3s ease;
      width: 100%;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      margin-top: 8px;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }

    .success-msg {
      background: rgba(16, 185, 129, 0.3);
      border: 2px solid rgba(16, 185, 129, 0.5);
      color: white;
      padding: 16px;
      border-radius: 14px;
      text-align: center;
      margin-top: 16px;
      display: none;
      font-weight: 600;
      font-size: 1rem;
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .success-msg::before {
      content: '‚úì ';
      font-size: 1.3rem;
    }

    .danger-zone {
      border: 2px solid rgba(239, 68, 68, 0.8);
      border-radius: 18px;
      padding: 24px;
      margin-top: 20px;
      background: rgba(239, 68, 68, 0.15);
    }

    .danger-warning {
      margin-bottom: 18px;
      color: white;
      font-weight: 700;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    body.font-small { font-size: 14px; }
    body.font-medium { font-size: 16px; }
    body.font-large { font-size: 18px; }
    body.font-xlarge { font-size: 20px; }

    @media (max-width: 768px) {
      .settings-grid {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 2.2rem;
      }

      .quick-actions {
        width: 100%;
      }

      .quick-btn {
        flex: 1;
        text-align: center;
        font-size: 0.85rem;
        padding: 10px 14px;
      }

      .theme-grid {
        grid-template-columns: 1fr;
      }
    }

    @media print {
      body::before { display: none; }
      .quick-actions, .back-link { display: none; }
      .settings-card { break-inside: avoid; }
    }
  </style>
</head>
<body data-theme="light">
  <div class="container">
    <div class="top-bar">
      <div class="back-link">
        <a href="journey.html">‚Üê Back to Journey</a>
      </div>
      <div class="quick-actions">
        <button class="quick-btn" onclick="resetSettings()">üîÑ Reset</button>
        <button class="quick-btn" onclick="shareProfile()">üì§ Share</button>
      </div>
    </div>

    <div class="header">
      <h1>‚öôÔ∏è Settings</h1>
      <p>Customize your Calm Hub experience</p>
    </div>

    <div class="settings-grid">
      <!-- Profile Card -->
      <div class="settings-card">
        <div class="card-title">üë§ Your Profile</div>
        
        <div class="setting-item">
          <label class="setting-label">Name</label>
          <input type="text" id="userName" class="input-field" placeholder="Enter your name">
        </div>
        
        <div class="setting-item">
          <label class="setting-label">Email Address</label>
          <input type="email" id="userEmail" class="input-field" placeholder="your@email.com">
        </div>
        
        <button class="btn btn-success" onclick="saveProfile()">üíæ Save Profile</button>
        <div class="success-msg" id="profileSuccess">Profile saved successfully!</div>
      </div>

      <!-- Theme Card -->
      <div class="settings-card">
        <div class="card-title">üé® Visual Theme</div>
        
        <label class="setting-label">Background Theme</label>
        <span class="setting-sublabel">Changes apply across all pages</span>
        
        <div class="theme-grid">
          <div class="theme-option active" data-theme="light" onclick="changeTheme('light')">‚òÄÔ∏è Light Day</div>
          <div class="theme-option" data-theme="night" onclick="changeTheme('night')">üåô Dark Night</div>
          <div class="theme-option" data-theme="ocean" onclick="changeTheme('ocean')">üåä Ocean Waves</div>
          <div class="theme-option" data-theme="forest" onclick="changeTheme('forest')">üå≤ Forest Trail</div>
        </div>
      </div>

      <!-- Notifications Card -->
      <div class="settings-card">
        <div class="card-title">üîî Notifications</div>
        
        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">Daily Check-in Reminders</div>
            <div class="toggle-desc">Get reminded to log your mood</div>
          </div>
          <div class="toggle-switch" id="dailyRemindersToggle" onclick="toggleSetting('dailyReminders')"></div>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">Meditation Alerts</div>
            <div class="toggle-desc">Practice mindfulness daily</div>
          </div>
          <div class="toggle-switch" id="meditationToggle" onclick="toggleSetting('meditation')"></div>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">Journal Prompts</div>
            <div class="toggle-desc">Evening reflection reminders</div>
          </div>
          <div class="toggle-switch" id="journalToggle" onclick="toggleSetting('journal')"></div>
        </div>

        <div class="setting-item" style="margin-top: 18px;">
          <label class="setting-label">‚è∞ Reminder Time</label>
          <input type="time" id="reminderTime" class="select-field" onchange="saveReminderTime()">
        </div>
      </div>

      <!-- Accessibility -->
      <div class="settings-card">
        <div class="card-title">‚ôø Accessibility</div>
        
        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">High Contrast Mode</div>
            <div class="toggle-desc">Darker background overlay</div>
          </div>
          <div class="toggle-switch" id="highContrastToggle" onclick="toggleAccessibility('highContrast')"></div>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">Reduce Motion</div>
            <div class="toggle-desc">Minimize animations</div>
          </div>
          <div class="toggle-switch" id="reduceMotionToggle" onclick="toggleAccessibility('reduceMotion')"></div>
        </div>

        <div class="setting-item" style="margin-top: 18px;">
          <label class="setting-label">üìè Font Size</label>
          <select class="select-field" id="fontSizeSelect" onchange="changeFontSize()">
            <option value="small">Small</option>
            <option value="medium" selected>Medium (Default)</option>
            <option value="large">Large</option>
            <option value="xlarge">Extra Large</option>
          </select>
        </div>
      </div>

      <!-- Privacy Card -->
      <div class="settings-card">
        <div class="card-title">üîí Privacy & Security</div>
        
        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">Anonymous Mode</div>
            <div class="toggle-desc">Hide identity in peer chats</div>
          </div>
          <div class="toggle-switch" id="anonymousToggle" onclick="toggleSetting('anonymous')"></div>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <div class="toggle-name">Save History</div>
            <div class="toggle-desc">Remember check-ins & journal</div>
          </div>
          <div class="toggle-switch active" id="saveHistoryToggle" onclick="toggleSetting('saveHistory')"></div>
        </div>

        <button class="btn btn-success" onclick="exportData()">üì• Export My Data</button>
        <button class="btn" onclick="importData()">üì§ Import Data</button>
        <div class="success-msg" id="exportSuccess">Data exported successfully!</div>
      </div>
    </div>

    <!-- Support Section -->
    <div class="settings-card" style="grid-column: 1 / -1;">
      <div class="card-title">‚ùì Support & Help Center</div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px;">
        <button class="btn" onclick="window.location.href='sos.html'">üö® Crisis Support</button>
        <button class="btn" onclick="contactSupport()">üìß Contact Us</button>
        <button class="btn" onclick="showTutorial()">üìö Tutorial</button>
        <button class="btn" onclick="giveFeedback()">üí¨ Feedback</button>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="settings-card" style="grid-column: 1 / -1;">
      <div class="card-title">‚ö†Ô∏è Danger Zone</div>
      <div class="danger-zone">
        <div class="danger-warning">
          <span>‚ö†Ô∏è</span>
          <span>This action cannot be undone. All data will be permanently deleted.</span>
        </div>
        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
      </div>
    </div>
  </div>

  <script>
    // ========= GLOBAL KEYS - USE IN ALL PAGES =========
    const KEYS = {
      NAME: 'userName',
      EMAIL: 'userEmail',
      THEME: 'calm_hub_theme',
      FONT_SIZE: 'fontSize',
      HIGH_CONTRAST: 'highContrast',
      REDUCE_MOTION: 'reduceMotion',
      DAILY_REMINDERS: 'dailyReminders',
      MEDITATION: 'meditation',
      JOURNAL: 'journal',
      REMINDER_TIME: 'reminderTime',
      ANONYMOUS: 'anonymous',
      SAVE_HISTORY: 'saveHistory'
    };

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      loadAllSettings();
      applyGlobalSettings();
    });

    function applyGlobalSettings() {
      const theme = localStorage.getItem(KEYS.THEME) || 'light';
      document.body.setAttribute('data-theme', theme);
      
      const fontSize = localStorage.getItem(KEYS.FONT_SIZE) || 'medium';
      document.body.classList.add('font-' + fontSize);
      
      if (localStorage.getItem(KEYS.HIGH_CONTRAST) === 'true') {
        document.body.classList.add('high-contrast');
      }
      if (localStorage.getItem(KEYS.REDUCE_MOTION) === 'true') {
        document.body.classList.add('reduce-motion');
      }
    }

    function saveProfile() {
      const name = document.getElementById('userName').value.trim();
      const email = document.getElementById('userEmail').value.trim();
      
      if (!name) {
        alert('‚ö†Ô∏è Please enter your name');
        return;
      }
      
      localStorage.setItem(KEYS.NAME, name);
      localStorage.setItem(KEYS.EMAIL, email);
      showSuccess('profileSuccess');
      
      window.dispatchEvent(new Event('profileUpdated'));
    }

    function changeTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
      document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
      localStorage.setItem(KEYS.THEME, theme);
      showSuccess('profileSuccess', 'Theme updated! üé®');
      
      window.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme } }));
    }

    function changeFontSize() {
      const size = document.getElementById('fontSizeSelect').value;
      document.body.className = document.body.className.replace(/font-\w+/g, '');
      document.body.classList.add('font-' + size);
      
      applyGlobalSettings();
      
      localStorage.setItem(KEYS.FONT_SIZE, size);
      showSuccess('profileSuccess', 'Font size updated! üìè');
    }

    function toggleAccessibility(name) {
      const toggle = document.getElementById(name + 'Toggle');
      const isActive = toggle.classList.toggle('active');
      
      if (name === 'highContrast') {
        document.body.classList.toggle('high-contrast', isActive);
      } else if (name === 'reduceMotion') {
        document.body.classList.toggle('reduce-motion', isActive);
      }
      
      localStorage.setItem(KEYS[name.toUpperCase().replace(/([A-Z])/g, '_$1')], isActive);
    }

    function toggleSetting(name) {
      const toggle = document.getElementById(name + 'Toggle');
      const isActive = toggle.classList.toggle('active');
      
      const keyMap = {
        'dailyReminders': KEYS.DAILY_REMINDERS,
        'meditation': KEYS.MEDITATION,
        'journal': KEYS.JOURNAL,
        'anonymous': KEYS.ANONYMOUS,
        'saveHistory': KEYS.SAVE_HISTORY
      };
      
      localStorage.setItem(keyMap[name] || name, isActive);
    }

    function saveReminderTime() {
      const time = document.getElementById('reminderTime').value;
      localStorage.setItem(KEYS.REMINDER_TIME, time);
      showSuccess('profileSuccess', 'Reminder time updated! ‚è∞');
    }

    function exportData() {
      const data = {
        version: '1.0',
        profile: {
          name: localStorage.getItem(KEYS.NAME),
          email: localStorage.getItem(KEYS.EMAIL)
        },
        settings: {},
        exportDate: new Date().toISOString()
      };
      
      Object.keys(KEYS).forEach(key => {
        const value = localStorage.getItem(KEYS[key]);
        if (value) data.settings[KEYS[key]] = value;
      });
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'calmhub-backup-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      URL.revokeObjectURL(url);
      
      showSuccess('exportSuccess');
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (confirm('‚ö†Ô∏è Import will overwrite current settings. Continue?')) {
              Object.keys(data.settings || {}).forEach(key => {
                localStorage.setItem(key, data.settings[key]);
              });
              
              alert('‚úì Data imported successfully!');
              location.reload();
            }
          } catch (error) {
            alert('‚ùå Invalid backup file');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function clearAllData() {
      if (confirm('‚ö†Ô∏è WARNING: Delete ALL data?')) {
        if (prompt('Type "DELETE" to confirm:') === 'DELETE') {
          localStorage.clear();
          alert('‚úì All data cleared!');
          location.reload();
        }
      }
    }

    function resetSettings() {
      if (confirm('üîÑ Reset settings to default?')) {
        const keepKeys = [KEYS.NAME, KEYS.EMAIL];
        
        Object.keys(localStorage).forEach(key => {
          if (!keepKeys.includes(key)) {
            localStorage.removeItem(key);
          }
        });
        alert('‚úì Settings reset!');
        location.reload();
      }
    }

    function shareProfile() {
      const name = localStorage.getItem(KEYS.NAME) || 'Calm Hub User';
      const text = `üåü Join ${name} on a wellness journey with Calm Hub! üßò‚Äç‚ôÇÔ∏è\n\n#MentalHealth #Wellness`;
      
      if (navigator.share) {
        navigator.share({ title: 'Calm Hub', text }).catch(() => {});
      } else {
        navigator.clipboard.writeText(text);
        alert('üìã Copied to clipboard!');
      }
    }

    function loadAllSettings() {
      const theme = localStorage.getItem(KEYS.THEME) || 'light';
      document.body.setAttribute('data-theme', theme);
      document.querySelector(`[data-theme="${theme}"]`)?.classList.add('active');
      
      document.getElementById('userName').value = localStorage.getItem(KEYS.NAME) || '';
      document.getElementById('userEmail').value = localStorage.getItem(KEYS.EMAIL) || '';
      
      const fontSize = localStorage.getItem(KEYS.FONT_SIZE) || 'medium';
      document.getElementById('fontSizeSelect').value = fontSize;
      
      if (localStorage.getItem(KEYS.HIGH_CONTRAST) === 'true') {
        document.getElementById('highContrastToggle').classList.add('active');
      }
      if (localStorage.getItem(KEYS.REDUCE_MOTION) === 'true') {
        document.getElementById('reduceMotionToggle').classList.add('active');
      }
      
      const toggles = ['dailyReminders', 'meditation', 'journal', 'anonymous'];
      toggles.forEach(s => {
        const keyMap = {
          'dailyReminders': KEYS.DAILY_REMINDERS,
          'meditation': KEYS.MEDITATION,
          'journal': KEYS.JOURNAL,
          'anonymous': KEYS.ANONYMOUS
        };
        
        if (localStorage.getItem(keyMap[s]) === 'true') {
          document.getElementById(s + 'Toggle')?.classList.add('active');
        }
      });
      
      if (localStorage.getItem(KEYS.SAVE_HISTORY) !== 'false') {
        document.getElementById('saveHistoryToggle')?.classList.add('active');
        localStorage.setItem(KEYS.SAVE_HISTORY, 'true');
      }
      
      document.getElementById('reminderTime').value = localStorage.getItem(KEYS.REMINDER_TIME) || '09:00';
    }

    function showSuccess(id, text) {
      const msg = document.getElementById(id);
      if (msg) {
        if (text) msg.textContent = '‚úì ' + text;
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', 3500);
      }
    }

    function contactSupport() {
      const name = localStorage.getItem(KEYS.NAME) || '';
      const email = localStorage.getItem(KEYS.EMAIL) || '';
      window.location.href = `mailto:support@calmhub.app?subject=Support from ${name}&body=Name: ${name}%0D%0AEmail: ${email}%0D%0A%0D%0AMessage:%0D%0A`;
    }

    function showTutorial() {
      alert('üìö Calm Hub Tutorial\n\n‚úÖ Complete your profile\n‚úÖ Set your theme\n‚úÖ Enable reminders\n‚úÖ Start daily check-ins\n‚úÖ Track your journey!\n\nSettings sync across all pages.');
    }

    function giveFeedback() {
      const feedback = prompt('üí¨ Share your feedback:');
      if (feedback && feedback.trim()) {
        alert('‚úì Thank you for your feedback! üíô');
      }
    }

    // Listen for storage changes
    window.addEventListener('storage', function(e) {
      if (e.key && Object.values(KEYS).includes(e.key)) {
        location.reload();
      }
    });
  </script>
</body>
</html>

