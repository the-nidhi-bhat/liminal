<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calm Hub ‚Äì Weekly Gratitude Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin:0; padding:0; box-sizing:border-box;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",Roboto,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    body {
      min-height:100vh;
      background:
        linear-gradient(135deg, rgba(236,72,153,0.16), rgba(59,130,246,0.18)),
        url("image.jpg");
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      background-attachment:fixed;
      padding:24px;
      color:#0f172a;
    }

    .shell {
      max-width:900px;
      margin:0 auto;
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(22px) saturate(180%);
      border-radius:30px;
      border:1px solid rgba(255,255,255,0.9);
      box-shadow:
        0 26px 60px rgba(15,23,42,0.18),
        0 0 0 1px rgba(255,255,255,0.5) inset;
      padding:28px 26px 22px;
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      margin-bottom:18px;
      flex-wrap:wrap;
    }
    .logo-row{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:20px;height:20px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#facc15,#f97316);
      box-shadow:0 0 0 6px rgba(251,191,36,0.25);
    }
    .title-main{font-size:22px;font-weight:700;}
    .subtitle{font-size:13px;color:#6b7280;}

    .back-chip{
      padding:8px 16px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#ffffff;
      font-size:13px;
      color:#4b5563;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow:0 4px 10px rgba(148,163,184,0.3);
      transition: all 0.3s ease;
      cursor:pointer;
    }
    .back-chip:hover {
      transform: translateY(-2px);
      box-shadow:0 6px 14px rgba(148,163,184,0.4);
    }

    .hero{
      margin-bottom:24px;
      padding-bottom:18px;
      border-bottom:1px solid rgba(148,163,184,0.35);
    }
    .hero h1{
      font-size:26px;
      font-weight:700;
      margin-bottom:6px;
    }
    .hero p{
      font-size:14px;
      color:#64748b;
      max-width:620px;
    }

    .section-label{
      font-size:13px;
      font-weight:600;
      color:#6b7280;
      margin-bottom:10px;
      text-transform:uppercase;
      letter-spacing:.05em;
    }

    .weeks-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:16px;
    }

    .card{
      background:#ffffff;
      border-radius:22px;
      padding:16px 16px 14px;
      border:1px solid #e5e7eb;
      box-shadow:0 10px 22px rgba(148,163,184,0.18);
    }
    .card-header-small{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:6px;
    }
    .icon-pill{
      width:34px;height:34px;border-radius:14px;
      background:linear-gradient(135deg,#e0e7ff,#fae8ff);
      display:flex;align-items:center;justify-content:center;
      font-size:18px;
    }
    .card-title{font-size:15px;font-weight:600;}
    .card-tag{
      margin-left:auto;
      padding:2px 8px;
      border-radius:999px;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.05em;
      background:#f3f4ff;
      color:#4f46e5;
    }

    .week-range{
      font-size:12px;
      color:#9ca3af;
      margin-bottom:6px;
    }

    .empty-msg{
      font-size:13px;
      color:#9ca3af;
      margin-top:4px;
    }

    /* Weekly jars row */
    .week-jar-grid{
      display:grid;
      grid-template-columns:repeat(7, minmax(0,1fr));
      gap:6px;
      margin-top:8px;
    }

    .day-jar{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:2px;
    }

    .day-jar svg{
      width:32px;
      height:46px;
    }

    .day-label{
      font-size:10px;
      color:#9ca3af;
    }

    .day-jar-filled rect.fill{
      opacity:0.9;
    }
    .day-jar-empty rect.fill{
      opacity:0.1;
    }

    .week-jar-caption{
      font-size:11px;
      color:#6b7280;
      margin-top:6px;
    }

    .footer{
      margin-top:22px;
      padding-top:14px;
      border-top:1px solid rgba(148,163,184,0.35);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      color:#6b7280;
    }
    .footer a{
      color:#6366f1;
      text-decoration:none;
      font-weight:500;
    }

    @media(max-width:768px){
      body{padding:16px;}
      .shell{padding:22px 18px 18px;border-radius:24px;}
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="top-row">
      <div class="logo-row">
        <div class="dot"></div>
        <div>
          <div class="title-main">Weekly Gratitude Library</div>
          <div class="subtitle">See your jar as weekly memory pages</div>
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="back-chip" onclick="window.location.href='gratitude.html'">‚Üê Back to Jar</button>
        <button class="back-chip" onclick="window.location.href='journey.html'">üìã Journey</button>
      </div>
    </div>

    <div class="hero">
      <h1>Your weeks of tiny good things</h1>
      <p>Each card below is one week of your life. Every small jar represents a day where you added at least one gratitude slip.</p>
    </div>

    <div class="section-label">Jar weeks</div>
    <div id="weeksContainer" class="weeks-grid"></div>
    <div id="emptyMessage" class="empty-msg" style="display:none;">
      Your weekly library is empty for now. Add a few slips in the Gratitude Jar and they will show up here automatically.
    </div>

    <div class="footer">
      <span>Idea: On tough days, pick any week and notice which days still had tiny good moments.</span>
      <span>Gratitude jar is fully local and private in your browser.</span>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "calmHubGratitudeJar";

    function loadSlips() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      } catch {
        return [];
      }
    }

    function getWeekKey(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      const weekNo = Math.ceil(((d - yearStart) / 86400000 + 1) / 7);
      const year = d.getUTCFullYear();
      return { key: year + "-W" + String(weekNo).padStart(2, "0"), year, week: weekNo };
    }

    function getWeekRange(d) {
      const day = d.getDay();
      const diffToMonday = (day + 6) % 7;
      const monday = new Date(d);
      monday.setDate(d.getDate() - diffToMonday);
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);

      const opts = { day: "2-digit", month: "short" };
      const from = monday.toLocaleDateString(undefined, opts);
      const to = sunday.toLocaleDateString(undefined, opts);
      return from + " ‚Äì " + to;
    }

    function renderWeeks() {
      const slips = loadSlips();
      const container = document.getElementById("weeksContainer");
      const emptyMsg = document.getElementById("emptyMessage");
      container.innerHTML = "";

      if (!slips.length) {
        emptyMsg.style.display = "block";
        return;
      }
      emptyMsg.style.display = "none";

      const groups = {};
      slips.forEach(slip => {
        const created = new Date(slip.createdAt || Date.now());
        const { key, year, week } = getWeekKey(created);
        if (!groups[key]) {
          groups[key] = {
            key,
            year,
            week,
            rangeLabel: getWeekRange(created),
            slips: []
          };
        }
        groups[key].slips.push({
          text: slip.text,
          date: created
        });
      });

      const sortedKeys = Object.keys(groups).sort((a,b) => {
        const [aYear, aWeek] = a.split("-W").map(Number);
        const [bYear, bWeek] = b.split("-W").map(Number);
        if (aYear === bYear) return bWeek - aWeek;
        return bYear - aYear;
      });

      const dayNamesShort = ["M","T","W","T","F","S","S"];

      sortedKeys.forEach(key => {
        const group = groups[key];
        const card = document.createElement("div");
        card.className = "card";

        const count = group.slips.length;
        const title = document.createElement("div");
        title.className = "card-header-small";
        title.innerHTML = `
          <div class="icon-pill">ü´ô</div>
          <div class="card-title">Week ${group.week}, ${group.year}</div>
          <span class="card-tag">${count} note${count === 1 ? "" : "s"}</span>
        `;
        card.appendChild(title);

        const range = document.createElement("div");
        range.className = "week-range";
        range.textContent = group.rangeLabel;
        card.appendChild(range);

        const anyDate = group.slips[0].date;
        const day = anyDate.getDay();
        const diffToMonday = (day + 6) % 7;
        const monday = new Date(anyDate);
        monday.setDate(anyDate.getDate() - diffToMonday);

        function hasSlipOn(date) {
          const key = date.toISOString().split("T")[0];
          return group.slips.some(s => s.date.toISOString().split("T")[0] === key);
        }

        const jarGrid = document.createElement("div");
        jarGrid.className = "week-jar-grid";

        for (let i = 0; i < 7; i++) {
          const d = new Date(monday);
          d.setDate(monday.getDate() + i);
          const filled = hasSlipOn(d);

          const dayJar = document.createElement("div");
          dayJar.className = "day-jar " + (filled ? "day-jar-filled" : "day-jar-empty");

          dayJar.innerHTML = `
            <svg viewBox="0 0 40 60">
              <rect x="10" y="4" width="20" height="6" rx="2" ry="2" fill="#e5e7eb"/>
              <rect x="8" y="8" width="24" height="40" rx="10" ry="10" fill="#f9fafb" stroke="#e5e7eb" stroke-width="1.5"/>
              <rect class="fill" x="9" y="30" width="22" height="16" rx="8" ry="8" fill="#bfdbfe"/>
            </svg>
            <div class="day-label">${dayNamesShort[i]}</div>
          `;

          jarGrid.appendChild(dayJar);
        }

        card.appendChild(jarGrid);

        const caption = document.createElement("div");
        caption.className = "week-jar-caption";
        caption.textContent = "Each filled jar = at least one gratitude slip that day.";
        card.appendChild(caption);

        container.appendChild(card);
      });
    }

    renderWeeks();
  </script>
</body>
</html>
