<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music Therapy Pro - CalmCompanion üéµ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    :root {
      --primary-gradient: linear-gradient(135deg, #8b5cf6, #6366f1);
      --success-gradient: linear-gradient(135deg, #10b981, #22c55e);
      --warning-gradient: linear-gradient(135deg, #f59e0b, #fbbf24);
      --danger-gradient: linear-gradient(135deg, #ef4444, #f87171);
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.18);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-tertiary: rgba(255, 255, 255, 0.5);
      --card-bg: rgba(30, 41, 59, 0.6);
      --card-hover: rgba(30, 41, 59, 0.8);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.25);
      --shadow-glow: 0 0 40px rgba(139, 92, 246, 0.3);
      --bg-overlay: rgba(15, 23, 42, 0.6);
    }

    body {
      min-height: 100vh;
      background: #0f172a url("image.jpg") center/cover fixed no-repeat;
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
    }

    body.dark-mode {
      background: #020617 url("image.jpg") center/cover fixed no-repeat;
      filter: brightness(0.8);
    }

    body.high-contrast {
      --text-primary: #ffffff;
      --text-secondary: #e0e0e0;
      --glass-bg: rgba(0, 0, 0, 0.9);
      --card-bg: rgba(0, 0, 0, 0.85);
    }

    body.large-text {
      font-size: 18px;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: var(--bg-overlay);
      backdrop-filter: blur(50px) saturate(180%);
      z-index: 0;
      pointer-events: none;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    .skeleton {
      background: linear-gradient(90deg, 
        rgba(255,255,255,0.05) 25%,
        rgba(255,255,255,0.15) 50%, 
        rgba(255,255,255,0.05) 75%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
      border-radius: 16px;
    }

    .skeleton-card {
      height: 320px;
      margin-bottom: 20px;
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      background: var(--glass-bg);
      backdrop-filter: blur(30px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      margin: 20px 0;
    }

    .empty-state-icon {
      font-size: 72px;
      margin-bottom: 20px;
      opacity: 0.6;
    }

    .empty-state h3 {
      font-size: 24px;
      margin-bottom: 12px;
    }

    .empty-state p {
      color: var(--text-secondary);
      font-size: 16px;
      margin-bottom: 24px;
    }

    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      background: var(--card-bg);
      backdrop-filter: blur(40px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 16px 20px;
      min-width: 300px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideInRight 0.3s ease;
    }

    .toast.success { border-left: 4px solid #10b981; }
    .toast.error { border-left: 4px solid #ef4444; }
    .toast.info { border-left: 4px solid #3b82f6; }
    .toast.warning { border-left: 4px solid #f59e0b; }

    @keyframes slideInRight {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(400px); opacity: 0; }
    }

    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 999;
      background: var(--glass-bg);
      backdrop-filter: blur(40px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 12px 20px;
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s;
      text-decoration: none;
    }

    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      background: var(--card-hover);
    }

    .onboarding-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(20px);
    }

    .onboarding-overlay.active {
      display: flex;
    }

    .onboarding-content {
      max-width: 600px;
      text-align: center;
      padding: 40px;
    }

    .onboarding-step {
      display: none;
    }

    .onboarding-step.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .onboarding-icon {
      font-size: 80px;
      margin-bottom: 24px;
    }

    .onboarding-step h2 {
      font-size: 32px;
      margin-bottom: 16px;
    }

    .onboarding-step p {
      font-size: 18px;
      color: var(--text-secondary);
      margin-bottom: 32px;
      line-height: 1.6;
    }

    .onboarding-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 32px;
    }

    .onboarding-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s;
    }

    .onboarding-dot.active {
      background: var(--primary-gradient);
      width: 30px;
      border-radius: 5px;
    }

    .fab-menu {
      position: fixed;
      bottom: 100px;
      right: 30px;
      z-index: 999;
    }

    .fab-main {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary-gradient);
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .fab-main:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-glow);
    }

    .fab-main.active {
      transform: rotate(45deg);
    }

    .fab-actions {
      display: none;
      flex-direction: column;
      gap: 12px;
      position: absolute;
      bottom: 70px;
      right: 0;
    }

    .fab-actions.active {
      display: flex;
      animation: fabSlideUp 0.3s ease;
    }

    @keyframes fabSlideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fab-action {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      color: white;
      font-size: 20px;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      position: relative;
    }

    .fab-action:hover {
      transform: scale(1.1);
      background: var(--card-hover);
    }

    .fab-action-label {
      position: absolute;
      right: 60px;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 13px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .fab-action:hover .fab-action-label {
      opacity: 1;
    }

    .offline-indicator {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--danger-gradient);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: var(--shadow-lg);
      z-index: 10000;
      animation: slideInUp 0.3s ease;
    }

    @keyframes slideInUp {
      from { transform: translateX(-50%) translateY(100px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    .offline-indicator.active {
      display: block;
    }

    .progress-indicator {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: rgba(139, 92, 246, 0.2);
      z-index: 10001;
      overflow: hidden;
    }

    .progress-indicator-bar {
      height: 100%;
      background: var(--primary-gradient);
      transition: width 0.3s ease;
    }

    .privacy-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      backdrop-filter: blur(40px);
      border-top: 1px solid var(--glass-border);
      padding: 20px;
      z-index: 9998;
      display: none;
      box-shadow: var(--shadow-lg);
    }

    .privacy-banner.active {
      display: block;
      animation: slideInUp 0.3s ease;
    }

    .privacy-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .privacy-text {
      flex: 1;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .privacy-actions {
      display: flex;
      gap: 12px;
    }

    .header {
      background: var(--glass-bg);
      backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 20px 32px;
      margin-bottom: 28px;
      box-shadow: var(--shadow-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 60px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .header-icon {
      width: 56px;
      height: 56px;
      border-radius: 18px;
      background: var(--primary-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: var(--shadow-glow);
    }

    .header-text h1 {
      font-size: 28px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 4px;
    }

    .header-text p {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .header-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 18px;
      border-radius: 16px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: rgba(139, 92, 246, 0.5);
    }

    .btn-primary {
      background: var(--primary-gradient);
      border: none;
    }

    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--glass-bg);
      backdrop-filter: blur(30px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: var(--shadow-sm);
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .stat-icon.streak { background: var(--success-gradient); }
    .stat-icon.time { background: var(--primary-gradient); }
    .stat-icon.sessions { background: var(--warning-gradient); }

    .stat-info h3 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 2px;
    }

    .stat-info p {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .recommendation-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(99, 102, 241, 0.2));
      border: 1px solid rgba(139, 92, 246, 0.4);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .recommendation-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .recommendation-badge {
      background: var(--primary-gradient);
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .mood-selector {
      background: var(--glass-bg);
      backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 20px 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-md);
    }

    .mood-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mood-options {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .mood-option {
      padding: 10px 18px;
      border-radius: 16px;
      border: 2px solid var(--glass-border);
      background: var(--card-bg);
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .mood-option:hover {
      transform: translateY(-2px);
      border-color: rgba(139, 92, 246, 0.6);
    }

    .mood-option.active {
      background: var(--primary-gradient);
      border-color: transparent;
      box-shadow: var(--shadow-glow);
    }

    .search-filter-bar {
      background: var(--glass-bg);
      backdrop-filter: blur(40px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-md);
    }

    .search-wrapper {
      position: relative;
      margin-bottom: 16px;
    }

    .search-input {
      width: 100%;
      padding: 14px 46px 14px 18px;
      border-radius: 16px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      color: #fff;
      font-size: 14px;
    }

    .search-input::placeholder { color: var(--text-tertiary); }

    .search-input:focus {
      outline: none;
      border-color: rgba(139, 92, 246, 0.5);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
    }

    .search-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
      color: var(--text-tertiary);
      pointer-events: none;
    }

    .filter-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .filter-btn {
      padding: 8px 16px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .filter-btn:hover {
      border-color: rgba(139, 92, 246, 0.5);
    }

    .filter-btn.active {
      background: var(--primary-gradient);
      border-color: transparent;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 0 4px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .view-all-btn {
      padding: 6px 14px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .view-all-btn:hover {
      background: var(--card-hover);
      border-color: rgba(139, 92, 246, 0.5);
    }

    .horizontal-scroll {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding-bottom: 12px;
      scrollbar-width: thin;
      scrollbar-color: rgba(139, 92, 246, 0.5) rgba(0, 0, 0, 0.2);
    }

    .horizontal-scroll::-webkit-scrollbar {
      height: 8px;
    }

    .horizontal-scroll::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .horizontal-scroll::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, 0.5);
      border-radius: 10px;
    }

    .music-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 18px;
      margin-bottom: 48px;
    }

    .music-card {
      background: var(--card-bg);
      backdrop-filter: blur(30px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 22px;
      box-shadow: var(--shadow-sm);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      min-width: 280px;
    }

    .music-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-lg);
      background: var(--card-hover);
      border-color: rgba(139, 92, 246, 0.5);
    }

    .card-actions {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 2;
      display: flex;
      gap: 8px;
    }

    .card-action-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .card-action-btn:hover {
      transform: scale(1.1);
      background: rgba(0, 0, 0, 0.8);
    }

    .card-action-btn.active {
      color: #ef4444;
      animation: heartBeat 0.3s ease;
    }

    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    .card-image {
      height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 52px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.35), rgba(56, 189, 248, 0.25));
      position: relative;
    }

    .youtube-badge {
      position: absolute;
      bottom: 12px;
      left: 12px;
      background: rgba(255, 0, 0, 0.9);
      color: #fff;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 4px;
      box-shadow: var(--shadow-sm);
    }

    .duration-badge {
      position: absolute;
      bottom: 12px;
      right: 12px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      color: #fff;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
    }

    .card-content {
      padding: 16px 18px 14px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #fff;
    }

    .card-artist {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .watch-btn {
      background: var(--primary-gradient);
      color: #fff;
      padding: 8px 14px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-sm);
      border: none;
      cursor: pointer;
      transition: all 0.3s;
    }

    .watch-btn:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-glow);
    }

    .community-stats {
      font-size: 11px;
      color: var(--text-tertiary);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--card-bg);
      backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 32px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: rgba(239, 68, 68, 0.3);
      border-color: #ef4444;
    }

    .modal h2 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .playlist-select {
      margin-bottom: 20px;
    }

    .playlist-select label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .playlist-select select {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    .playlist-select select:focus {
      outline: none;
      border-color: rgba(139, 92, 246, 0.5);
    }

    .playlist-select input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      color: #fff;
      font-size: 14px;
    }

    .playlist-select input:focus {
      outline: none;
      border-color: rgba(139, 92, 246, 0.5);
    }

    .playlist-item {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .playlist-item-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .playlist-item-icon {
      font-size: 24px;
    }

    .playlist-item-remove {
      background: var(--danger-gradient);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .playlist-item-remove:hover {
      transform: scale(1.05);
    }

    .playlist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }

    .playlist-card {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .playlist-card:hover {
      transform: translateY(-4px);
      border-color: rgba(139, 92, 246, 0.5);
      background: var(--card-hover);
    }

    .playlist-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .playlist-name {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .playlist-count {
      font-size: 12px;
      color: var(--text-secondary);
    }

    @media (max-width: 768px) {
      .container { padding: 16px; }
      .header { padding: 16px 20px; margin-top: 70px; }
      .header-text h1 { font-size: 22px; }
      .music-grid { grid-template-columns: 1fr; }
      .stats-bar { grid-template-columns: 1fr; }
      .fab-menu { bottom: 80px; right: 20px; }
      .toast-container { right: 10px; left: 10px; }
      .toast { min-width: auto; }
      .privacy-content { flex-direction: column; text-align: center; }
      .modal { padding: 24px; }
      .back-button { top: 10px; left: 10px; }
    }
  </style>
</head>
<body>  <a href="journey.html" class="back-button">
    ‚Üê Back to Journey
  </a>

  <div class="progress-indicator" id="progressIndicator">
    <div class="progress-indicator-bar" id="progressBar"></div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <div class="offline-indicator" id="offlineIndicator">
    üì° You're offline - Some features may be limited
  </div>

  <div class="privacy-banner" id="privacyBanner">
    <div class="privacy-content">
      <div class="privacy-text">
        üîí <strong>Your Privacy Matters:</strong> All data is stored locally on your device.
      </div>
      <div class="privacy-actions">
        <button class="btn btn-primary" onclick="acceptPrivacy()">Accept</button>
      </div>
    </div>
  </div>

  <div class="onboarding-overlay" id="onboardingOverlay">
    <div class="onboarding-content">
      <div class="onboarding-step active" data-step="1">
        <div class="onboarding-icon">üéµ</div>
        <h2>Welcome to Music Therapy</h2>
        <p>Your personal music therapy companion for mental wellness!</p>
        <button class="btn btn-primary" onclick="nextOnboardingStep()">Get Started ‚Üí</button>
      </div>

      <div class="onboarding-step" data-step="2">
        <div class="onboarding-icon">üß†</div>
        <h2>Track Your Mood</h2>
        <p>Select how you're feeling and we'll recommend music tailored to your emotional state.</p>
        <button class="btn btn-primary" onclick="nextOnboardingStep()">Continue ‚Üí</button>
      </div>

      <div class="onboarding-step" data-step="3">
        <div class="onboarding-icon">‚è±Ô∏è</div>
        <h2>Create Playlists</h2>
        <p>Organize your favorite tracks into custom playlists for easy access.</p>
        <button class="btn btn-primary" onclick="completeOnboarding()">Start Now ‚Üí</button>
      </div>

      <div class="onboarding-dots">
        <div class="onboarding-dot active"></div>
        <div class="onboarding-dot"></div>
        <div class="onboarding-dot"></div>
      </div>
    </div>
  </div>

  <div class="container" id="main-content">
    <div class="header">
      <div class="header-left">
        <div class="header-icon">üéµ</div>
        <div class="header-text">
          <h1>Music Therapy Pro</h1>
          <p>Healing through Sound</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn" id="themeToggleBtn" onclick="toggleTheme()">üåô Theme</button>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-icon streak">üî•</div>
        <div class="stat-info">
          <h3 id="streakCount">0</h3>
          <p>Day Streak</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon time">‚è±Ô∏è</div>
        <div class="stat-info">
          <h3 id="totalTime">0</h3>
          <p>Minutes Today</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon sessions">üéµ</div>
        <div class="stat-info">
          <h3 id="sessionCount">0</h3>
          <p>Sessions This Week</p>
        </div>
      </div>
    </div>

    <div class="mood-selector">
      <div class="mood-title">üß† How are you feeling today?</div>
      <div class="mood-options">
        <div class="mood-option" data-mood="happy" onclick="selectMood('happy')">üòä Happy</div>
        <div class="mood-option" data-mood="anxious" onclick="selectMood('anxious')">üò∞ Anxious</div>
        <div class="mood-option" data-mood="sad" onclick="selectMood('sad')">üòî Sad</div>
        <div class="mood-option" data-mood="tired" onclick="selectMood('tired')">üò¥ Tired</div>
        <div class="mood-option" data-mood="stressed" onclick="selectMood('stressed')">üò§ Stressed</div>
        <div class="mood-option" data-mood="calm" onclick="selectMood('calm')">üßò Calm</div>
      </div>
    </div>

    <!-- FAVORITES SECTION - VISIBLE -->
    <div id="favoritesSection" style="margin-bottom: 32px;">
      <div class="section-header">
        <h2 class="section-title">‚ù§Ô∏è Your Favorites</h2>
      </div>
      <div class="horizontal-scroll" id="favoritesContainer"></div>
    </div>

    <!-- PLAYLISTS SECTION - VISIBLE -->
    <div id="playlistsSection" style="margin-bottom: 32px;">
      <div class="section-header">
        <h2 class="section-title">üíú Your Playlists</h2>
        <button class="view-all-btn" onclick="createPlaylist()">‚ûï Create New</button>
      </div>
      <div class="playlist-grid" id="playlistsContainer"></div>
    </div>

    <div class="search-filter-bar">
      <div class="search-wrapper">
        <input type="text" class="search-input" id="searchInput" 
               placeholder="üîç Search for music..." 
               oninput="searchMusic()">
        <span class="search-icon">üîç</span>
      </div>
      <div class="filter-row">
        <span class="filter-label">Duration:</span>
        <button class="filter-btn active" data-duration="all" onclick="filterByDuration('all')">All</button>
        <button class="filter-btn" data-duration="short" onclick="filterByDuration('short')">5-15 min</button>
        <button class="filter-btn" data-duration="medium" onclick="filterByDuration('medium')">15-30 min</button>
        <button class="filter-btn" data-duration="long" onclick="filterByDuration('long')">30+ min</button>

        <span class="filter-label" style="margin-left: 20px;">Category:</span>
        <button class="filter-btn active" data-category="all" onclick="filterByCategory('all')">All</button>
        <button class="filter-btn" data-category="meditation" onclick="filterByCategory('meditation')">Meditation</button>
        <button class="filter-btn" data-category="sleep" onclick="filterByCategory('sleep')">Sleep</button>
        <button class="filter-btn" data-category="stress" onclick="filterByCategory('stress')">Stress Relief</button>
      </div>
    </div>

    <div id="loadingState" style="display: none;">
      <div class="skeleton skeleton-card"></div>
      <div class="skeleton skeleton-card"></div>
    </div>

    <div id="musicContainer"></div>
  </div>

  <div class="fab-menu">
    <div class="fab-actions" id="fabActions">
      <button class="fab-action" onclick="exportData()">
        <span class="fab-action-label">Export Data</span>üíæ
      </button>
      <button class="fab-action" onclick="shareProgress()">
        <span class="fab-action-label">Share</span>üì§
      </button>
    </div>
    <button class="fab-main" id="fabMain" onclick="toggleFAB()">‚ûï</button>
  </div>

  <!-- ADD TO PLAYLIST MODAL -->
  <div class="modal-overlay" id="addToPlaylistModal">
    <div class="modal">
      <button class="modal-close" onclick="closeAddToPlaylist()">‚úï</button>
      <h2>‚ûï Add to Playlist</h2>

      <div class="playlist-select">
        <label>Select Playlist:</label>
        <select id="playlistSelect" style="margin-bottom: 12px;">
          <option value="">Choose a playlist...</option>
        </select>

        <button class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 12px;" 
                onclick="addTrackToPlaylist()">‚ûï Add Song</button>
      </div>

      <div style="text-align: center; margin: 20px 0; color: var(--text-secondary);">‚Äî OR ‚Äî</div>

      <div class="playlist-select">
        <label>Create New Playlist:</label>
        <input type="text" id="newPlaylistName" placeholder="Enter playlist name...">
        <button class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 12px;" 
                onclick="createAndAddToPlaylist()">‚ú® Create & Add</button>
      </div>
    </div>
  </div>

  <!-- VIEW PLAYLIST MODAL -->
  <div class="modal-overlay" id="viewPlaylistModal">
    <div class="modal" style="max-width: 800px;">
      <button class="modal-close" onclick="closeViewPlaylist()">‚úï</button>
      <h2 id="playlistViewTitle">üíú Playlist</h2>
      <div id="playlistViewContent"></div>
    </div>
  </div>

  <script>
    function generateSongName(happinessLevel, instrument) {
      const happinessDescriptors = {
        1: ['Melancholic', 'Somber', 'Reflective', 'Pensive', 'Gentle'],
        2: ['Peaceful', 'Calming', 'Serene', 'Tranquil', 'Soothing'],
        3: ['Balanced', 'Harmonious', 'Centered', 'Flowing', 'Steady'],
        4: ['Uplifting', 'Cheerful', 'Bright', 'Joyful', 'Radiant'],
        5: ['Euphoric', 'Vibrant', 'Energetic', 'Exhilarating', 'Blissful']
      };

      const instrumentStyles = {
        'piano': ['Melody', 'Keys', 'Harmony', 'Notes', 'Composition'],
        'flute': ['Breeze', 'Whispers', 'Flow', 'Stream', 'Echo'],
        'guitar': ['Strings', 'Resonance', 'Acoustic', 'Chords', 'Melody'],
        'sitar': ['Raga', 'Journey', 'Tradition', 'Heritage', 'Essence'],
        'violin': ['Aria', 'Symphony', 'Elegance', 'Grace', 'Movement'],
        'harp': ['Cascade', 'Ripples', 'Waves', 'Dreams', 'Reverie'],
        'tabla': ['Rhythm', 'Pulse', 'Beat', 'Cycles', 'Pattern'],
        'singing bowl': ['Resonance', 'Vibrations', 'Healing', 'Om', 'Energy'],
        'ambient': ['Soundscape', 'Atmosphere', 'Space', 'Dimensions', 'Layers'],
        'nature': ['Sounds', 'Elements', 'Natural', 'Organic', 'Pure']
      };

      const descriptor = happinessDescriptors[happinessLevel][Math.floor(Math.random() * happinessDescriptors[happinessLevel].length)];
      const style = instrumentStyles[instrument][Math.floor(Math.random() * instrumentStyles[instrument].length)];

      return `${descriptor} ${instrument.charAt(0).toUpperCase() + instrument.slice(1)} ${style}`;
    }

    const musicData = [
      { id: 1, name: generateSongName(3, 'flute'), artist: 'Purbayan Chatterjee', icon: 'ü™à',
        url: 'https://youtu.be/ggfebQ-5-UE', duration: 'short', category: 'general',
        plays: 1247, helpful: 892, happinessLevel: 3, instrument: 'flute' },
      { id: 2, name: generateSongName(4, 'flute'), artist: 'Rakesh Chaurasia', icon: 'üéº',
        url: 'https://youtu.be/utcDd13hz4g', duration: 'long', category: 'general',
        plays: 2341, helpful: 1567, happinessLevel: 4, instrument: 'flute' },
      { id: 3, name: generateSongName(2, 'piano'), artist: 'Meditation Music', icon: 'üéπ',
        url: 'https://youtu.be/8715GvmhKjU', duration: 'medium', category: 'meditation',
        plays: 3456, helpful: 2341, happinessLevel: 2, instrument: 'piano' },
      { id: 4, name: generateSongName(2, 'nature'), artist: 'Healing Vibes', icon: 'üåø',
        url: 'https://youtu.be/ujyu7tkyxtw', duration: 'long', category: 'sleep',
        plays: 1829, helpful: 1234, happinessLevel: 2, instrument: 'nature' },
      { id: 5, name: generateSongName(2, 'ambient'), artist: 'Calm Collective', icon: 'üåä',
        url: 'https://youtu.be/C9hMaqQFKXk', duration: 'long', category: 'sleep',
        plays: 2103, helpful: 1456, happinessLevel: 2, instrument: 'ambient' },
      { id: 6, name: generateSongName(3, 'guitar'), artist: 'Acoustic Therapy', icon: 'üé∏',
        url: 'https://youtu.be/-4rtl36Cz48', duration: 'medium', category: 'general',
        plays: 1567, helpful: 1023, happinessLevel: 3, instrument: 'guitar' },
      { id: 7, name: generateSongName(2, 'singing bowl'), artist: 'Spiritual Awakening', icon: 'üïâÔ∏è',
        url: 'https://youtu.be/jqnAaUOFOyE', duration: 'medium', category: 'meditation',
        plays: 2789, helpful: 1890, happinessLevel: 2, instrument: 'singing bowl' },
      { id: 8, name: generateSongName(2, 'singing bowl'), artist: 'Meditation Masters', icon: 'üîî',
        url: 'https://youtu.be/pFenlzgBEns', duration: 'long', category: 'meditation',
        plays: 3210, helpful: 2156, happinessLevel: 2, instrument: 'singing bowl' },
      { id: 9, name: generateSongName(1, 'ambient'), artist: 'Sleep Sounds', icon: 'üåô',
        url: 'https://youtu.be/oUxQ0KUU-eY', duration: 'long', category: 'sleep',
        plays: 4567, helpful: 3234, happinessLevel: 1, instrument: 'ambient' },
      { id: 10, name: generateSongName(2, 'nature'), artist: 'Nature Sounds', icon: '‚õàÔ∏è',
        url: 'https://youtu.be/6o5npd-KS5s', duration: 'long', category: 'sleep',
        plays: 3890, helpful: 2678, happinessLevel: 2, instrument: 'nature' },
      { id: 11, name: generateSongName(1, 'ambient'), artist: 'Brainwave Music', icon: 'üí§',
        url: 'https://youtu.be/hNn2tBohjxE', duration: 'long', category: 'sleep',
        plays: 2456, helpful: 1789, happinessLevel: 1, instrument: 'ambient' },
      { id: 12, name: generateSongName(2, 'nature'), artist: 'Coastal Calm', icon: 'üåä',
        url: 'https://youtu.be/jMcMLAyddzU', duration: 'long', category: 'sleep',
        plays: 2890, helpful: 1956, happinessLevel: 2, instrument: 'nature' },
      { id: 13, name: generateSongName(2, 'piano'), artist: 'Nighttime Melodies', icon: 'üéπ',
        url: 'https://youtu.be/1loVfme-8hc', duration: 'medium', category: 'stress',
        plays: 1678, helpful: 1123, happinessLevel: 2, instrument: 'piano' },
      { id: 14, name: generateSongName(3, 'nature'), artist: 'Stress Relief', icon: 'üçÉ',
        url: 'https://youtu.be/IaWMS9vmWRM', duration: 'short', category: 'stress',
        plays: 1456, helpful: 987, happinessLevel: 3, instrument: 'nature' },
      { id: 15, name: generateSongName(3, 'guitar'), artist: 'Peaceful Minds', icon: 'üéµ',
        url: 'https://youtu.be/CG4hbwjzBkw', duration: 'medium', category: 'stress',
        plays: 1890, helpful: 1234, happinessLevel: 3, instrument: 'guitar' },
      { id: 16, name: generateSongName(4, 'ambient'), artist: 'Zen Masters', icon: '‚òÄÔ∏è',
        url: 'https://youtu.be/z0Jpoyv-T7E', duration: 'short', category: 'meditation',
        plays: 2134, helpful: 1567, happinessLevel: 4, instrument: 'ambient' },
      { id: 17, name: generateSongName(3, 'ambient'), artist: 'Calm Waves', icon: 'üå∏',
        url: 'https://youtu.be/9tHmbMWStuM', duration: 'medium', category: 'stress',
        plays: 1234, helpful: 890, happinessLevel: 3, instrument: 'ambient' },
      { id: 18, name: generateSongName(3, 'ambient'), artist: 'Sound Therapy', icon: 'üéµ',
        url: 'https://youtu.be/4XluDP8Ob54', duration: 'long', category: 'stress',
        plays: 2567, helpful: 1789, happinessLevel: 3, instrument: 'ambient' },
      { id: 19, name: generateSongName(2, 'nature'), artist: 'Anxiety Relief', icon: 'üå¨Ô∏è',
        url: 'https://youtu.be/7wTsD8Q9SyI', duration: 'short', category: 'stress',
        plays: 1678, helpful: 1234, happinessLevel: 2, instrument: 'nature' },
      { id: 20, name: generateSongName(3, 'ambient'), artist: 'Body & Mind', icon: 'üíÜ',
        url: 'https://youtu.be/OL6IJfX-N2g', duration: 'medium', category: 'stress',
        plays: 1456, helpful: 1023, happinessLevel: 3, instrument: 'ambient' },
      { id: 21, name: generateSongName(3, 'singing bowl'), artist: 'Energy Healing', icon: 'üîÆ',
        url: 'https://youtu.be/BTN61VCCQqo', duration: 'long', category: 'meditation',
        plays: 2345, helpful: 1678, happinessLevel: 3, instrument: 'singing bowl' },
      { id: 22, name: generateSongName(2, 'piano'), artist: 'Deep Healing', icon: 'üíù',
        url: 'https://youtu.be/nl_7H8UYGDk', duration: 'long', category: 'stress',
        plays: 1890, helpful: 1345, happinessLevel: 2, instrument: 'piano' }
    ];

    function loadData(key, defaultValue = null) {
      try {
        const data = localStorage.getItem('calmcompanion_' + key);
        return data ? JSON.parse(data) : defaultValue;
      } catch (e) { return defaultValue; }
    }

    function saveData(key, value) {
      try {
        localStorage.setItem('calmcompanion_' + key, JSON.stringify(value));
      } catch (e) {
        console.error('Error saving data:', e);
        showToast('Error saving data', 'error');
      }
    }

    let currentMood = null;
    let favorites = loadData('favorites', []);
    let playlists = loadData('playlists', []);
    let onboardingComplete = loadData('onboardingComplete', false);
    let privacyAccepted = loadData('privacyAccepted', false);

    let stats = loadData('stats', {
      streak: 0, lastVisit: null, totalMinutes: 0, todayMinutes: 0, weekSessions: 0
    });

    let currentFilters = { search: '', duration: 'all', category: 'all', mood: null };
    let selectedTrackForPlaylist = null;

    function init() {
      console.log('üéµ Initializing Music Therapy Pro...');

      if (!onboardingComplete) showOnboarding();
      if (!privacyAccepted) showPrivacyBanner();

      initTheme();
      updateStreak();
      updateStats();
      showLoadingState();

      setTimeout(() => {
        hideLoadingState();
        renderMusic();
        renderFavorites();
        renderPlaylists();
      }, 800);

      initOfflineDetection();

      showToast('Welcome back! üéµ', 'success');
    }

    function initTheme() {
      const stored = localStorage.getItem('calmcompanion_theme') || 'default';
      if (stored === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('themeToggleBtn').innerHTML = '‚òÄÔ∏è Theme';
      }
    }

    function toggleTheme() {
      const btn = document.getElementById('themeToggleBtn');
      if (document.body.classList.contains('dark-mode')) {
        document.body.classList.remove('dark-mode');
        btn.innerHTML = 'üåô Theme';
        localStorage.setItem('calmcompanion_theme', 'default');
      } else {
        document.body.classList.add('dark-mode');
        btn.innerHTML = '‚òÄÔ∏è Theme';
        localStorage.setItem('calmcompanion_theme', 'dark');
      }
    }

    function showToast(message, type = 'info', duration = 3000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;

      const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è' };

      toast.innerHTML = `
        <span style="font-size: 20px;">${icons[type]}</span>
        <span style="flex: 1;">${message}</span>
        <button onclick="this.parentElement.remove()" 
                style="background: none; border: none; color: white; cursor: pointer; font-size: 18px;">‚úï</button>
      `;

      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    function showOnboarding() { document.getElementById('onboardingOverlay').classList.add('active'); }

    function nextOnboardingStep() {
      const steps = document.querySelectorAll('.onboarding-step');
      let currentIndex = 0;
      steps.forEach((step, index) => {
        if (step.classList.contains('active')) currentIndex = index;
      });

      if (currentIndex < steps.length - 1) {
        steps[currentIndex].classList.remove('active');
        steps[currentIndex + 1].classList.add('active');

        const dots = document.querySelectorAll('.onboarding-dot');
        dots[currentIndex].classList.remove('active');
        dots[currentIndex + 1].classList.add('active');
      }
    }

    function completeOnboarding() {
      document.getElementById('onboardingOverlay').classList.remove('active');
      onboardingComplete = true;
      saveData('onboardingComplete', true);
      showToast('Welcome! Let\'s start your healing journey üåü', 'success');
    }

    function showPrivacyBanner() { document.getElementById('privacyBanner').classList.add('active'); }

    function acceptPrivacy() {
      document.getElementById('privacyBanner').classList.remove('active');
      privacyAccepted = true;
      saveData('privacyAccepted', true);
    }

    function showLoadingState() {
      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('musicContainer').style.display = 'none';
    }

    function hideLoadingState() {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('musicContainer').style.display = 'block';
    }

    function updateProgress(percentage) {
      document.getElementById('progressBar').style.width = percentage + '%';
    }

    function initOfflineDetection() {
      window.addEventListener('online', () => {
        document.getElementById('offlineIndicator').classList.remove('active');
        showToast('Back online! üåê', 'success');
      });

      window.addEventListener('offline', () => {
        document.getElementById('offlineIndicator').classList.add('active');
      });

      if (!navigator.onLine) document.getElementById('offlineIndicator').classList.add('active');
    }

    function updateStreak() {
      const today = new Date().toDateString();
      const lastVisit = stats.lastVisit;

      if (lastVisit !== today) {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);

        if (lastVisit === yesterday.toDateString()) stats.streak++;
        else if (lastVisit !== null) stats.streak = 1;
        else stats.streak = 1;

        stats.lastVisit = today;
        stats.todayMinutes = 0;
        saveData('stats', stats);
      }
    }

    function updateStats() {
      document.getElementById('streakCount').textContent = stats.streak;
      document.getElementById('totalTime').textContent = stats.todayMinutes;
      document.getElementById('sessionCount').textContent = stats.weekSessions;
    }

    function selectMood(mood) {
      currentMood = mood;
      currentFilters.mood = mood;

      document.querySelectorAll('.mood-option').forEach(el => el.classList.remove('active'));
      event.target.classList.add('active');

      renderMusic();
    }

    // RENDER FAVORITES - VISIBLE ON MAIN PAGE
    function renderFavorites() {
      const container = document.getElementById('favoritesContainer');
      const section = document.getElementById('favoritesSection');

      if (favorites.length === 0) {
        section.style.display = 'none';
        return;
      }

      section.style.display = 'block';
      container.innerHTML = '';

      favorites.forEach(trackId => {
        const track = musicData.find(t => t.id === trackId);
        if (track) container.appendChild(createMusicCard(track));
      });
    }

    // RENDER PLAYLISTS - VISIBLE ON MAIN PAGE
    function renderPlaylists() {
      const container = document.getElementById('playlistsContainer');
      const section = document.getElementById('playlistsSection');

      if (playlists.length === 0) {
        section.style.display = 'none';
        return;
      }

      section.style.display = 'block';
      container.innerHTML = '';

      playlists.forEach((playlist, index) => {
        const card = document.createElement('div');
        card.className = 'playlist-card';
        card.innerHTML = `
          <div class="playlist-icon">${playlist.icon}</div>
          <div class="playlist-name">${playlist.name}</div>
          <div class="playlist-count">${playlist.tracks.length} tracks</div>
        `;
        card.onclick = () => viewPlaylistDetails(playlist.name, playlist.icon, playlist.tracks, index);
        container.appendChild(card);
      });
    }

    function renderMusic() {
      const container = document.getElementById('musicContainer');
      const { search, duration, category, mood } = currentFilters;

      updateProgress(20);

      let filtered = musicData.filter(track => {
        const matchSearch = !search || 
          track.name.toLowerCase().includes(search.toLowerCase()) ||
          track.artist.toLowerCase().includes(search.toLowerCase());

        const matchDuration = duration === 'all' || track.duration === duration;
        const matchCategory = category === 'all' || track.category === category;

        let matchMood = true;
        if (mood) {
          if (mood === 'anxious' || mood === 'stressed') matchMood = track.category === 'stress';
          else if (mood === 'tired') matchMood = track.category === 'sleep';
          else if (mood === 'sad') matchMood = track.category === 'meditation';
          else if (mood === 'happy') matchMood = track.happinessLevel >= 3;
        }

        return matchSearch && matchDuration && matchCategory && matchMood;
      });

      updateProgress(50);

      const grouped = {};
      filtered.forEach(track => {
        if (!grouped[track.category]) grouped[track.category] = [];
        grouped[track.category].push(track);
      });

      updateProgress(75);

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üîç</div>
            <h3>No music found</h3>
            <p>Try different filters or search terms</p>
            <button class="btn btn-primary" onclick="resetFilters()">Reset Filters</button>
          </div>
        `;
        updateProgress(100);
        setTimeout(() => updateProgress(0), 500);
        return;
      }

      container.innerHTML = '';

      const categoryNames = {
        general: 'üéµ General Music Therapy',
        meditation: 'üßò Meditation Music',
        sleep: 'üò¥ Sleep & Relaxation',
        stress: 'üíö Stress Relief'
      };

      Object.keys(grouped).forEach(cat => {
        const section = document.createElement('div');
        section.style.marginBottom = '48px';

        section.innerHTML = `
          <div class="section-header">
            <h2 class="section-title">${categoryNames[cat]}</h2>
          </div>
          <div class="music-grid" id="grid-${cat}"></div>
        `;

        container.appendChild(section);

        const grid = document.getElementById(`grid-${cat}`);
        grouped[cat].forEach(track => grid.appendChild(createMusicCard(track)));
      });

      updateProgress(100);
      setTimeout(() => updateProgress(0), 500);
    }

    function resetFilters() {
      currentFilters = { search: '', duration: 'all', category: 'all', mood: null };

      document.getElementById('searchInput').value = '';
      document.querySelectorAll('[data-duration]').forEach(btn => btn.classList.remove('active'));
      document.querySelector('[data-duration="all"]').classList.add('active');
      document.querySelectorAll('[data-category]').forEach(btn => btn.classList.remove('active'));
      document.querySelector('[data-category="all"]').classList.add('active');
      document.querySelectorAll('.mood-option').forEach(el => el.classList.remove('active'));

      currentMood = null;
      renderMusic();
      showToast('Filters reset', 'info');
    }

    function createMusicCard(track) {
      const card = document.createElement('div');
      card.className = 'music-card';

      const isFavorite = favorites.includes(track.id);
      const durationLabels = { short: '5-15 min', medium: '15-30 min', long: '30+ min' };

      card.innerHTML = `
        <div class="card-actions">
          <button class="card-action-btn ${isFavorite ? 'active' : ''}" 
                  onclick="event.stopPropagation(); toggleFavorite(${track.id})"
                  title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
            ${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
          </button>
          <button class="card-action-btn" 
                  onclick="event.stopPropagation(); openAddToPlaylist(${track.id})"
                  title="Add to playlist">
            ‚ûï
          </button>
        </div>
        <div class="card-image">
          ${track.icon}
          <div class="youtube-badge">‚ñ∂ YouTube</div>
          <div class="duration-badge">${durationLabels[track.duration]}</div>
        </div>
        <div class="card-content">
          <div class="card-title">${track.name}</div>
          <div class="card-artist">${track.artist}</div>
          <div class="card-footer">
            <button class="watch-btn" onclick="playTrack(${track.id})">
              Watch Now ‚Üí
            </button>
            <div class="community-stats" title="${track.helpful} found helpful">
              üë• ${formatNumber(track.plays)}
            </div>
          </div>
        </div>
      `;

      return card;
    }

    function formatNumber(num) {
      if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
      return num;
    }

    function openAddToPlaylist(trackId) {
      selectedTrackForPlaylist = trackId;
      const modal = document.getElementById('addToPlaylistModal');
      const select = document.getElementById('playlistSelect');

      select.innerHTML = '<option value="">Choose a playlist...</option>';

      playlists.forEach((playlist, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${playlist.icon} ${playlist.name} (${playlist.tracks.length} songs)`;
        select.appendChild(option);
      });

      if (playlists.length === 0) {
        select.innerHTML = '<option value="">No playlists yet - create one below!</option>';
      }

      document.getElementById('newPlaylistName').value = '';
      modal.classList.add('active');
    }

    function closeAddToPlaylist() {
      document.getElementById('addToPlaylistModal').classList.remove('active');
      selectedTrackForPlaylist = null;
    }

    function addTrackToPlaylist() {
      const select = document.getElementById('playlistSelect');
      const selectedIndex = select.value;

      if (!selectedIndex && selectedIndex !== '0') {
        showToast('Please select a playlist', 'warning');
        return;
      }

      const playlist = playlists[parseInt(selectedIndex)];

      if (playlist.tracks.includes(selectedTrackForPlaylist)) {
        showToast('Song already in this playlist', 'info');
        return;
      }

      playlist.tracks.push(selectedTrackForPlaylist);
      saveData('playlists', playlists);

      const track = musicData.find(t => t.id === selectedTrackForPlaylist);
      showToast(`‚úÖ Added "${track.name}" to ${playlist.name}`, 'success');

      renderPlaylists();
      closeAddToPlaylist();
    }

    function createAndAddToPlaylist() {
      const name = document.getElementById('newPlaylistName').value.trim();

      if (!name) {
        showToast('Please enter a playlist name', 'warning');
        return;
      }

      const icons = ['üéµ', 'üíú', 'üåô', 'üî•', '‚≠ê', 'üå∏', 'üé∏', 'üéπ', 'üéß', 'üíô', 'üé§', 'üé∫'];
      const icon = icons[Math.floor(Math.random() * icons.length)];

      const newPlaylist = {
        name: name,
        icon: icon,
        tracks: [selectedTrackForPlaylist]
      };

      playlists.push(newPlaylist);
      saveData('playlists', playlists);

      const track = musicData.find(t => t.id === selectedTrackForPlaylist);
      showToast(`‚ú® Created "${name}" and added "${track.name}"!`, 'success');

      renderPlaylists();
      closeAddToPlaylist();
    }

    function createPlaylist() {
      const name = prompt('Enter playlist name:');
      if (!name) return;

      const icons = ['üéµ', 'üíú', 'üåô', 'üî•', '‚≠ê', 'üå∏', 'üé∏', 'üéπ', 'üéß', 'üíô', 'üé§', 'üé∫'];
      const icon = icons[Math.floor(Math.random() * icons.length)];

      playlists.push({ name: name, icon: icon, tracks: [] });
      saveData('playlists', playlists);
      renderPlaylists();
      showToast('‚úÖ Playlist created!', 'success');
    }

    function viewPlaylistDetails(name, icon, trackIds, playlistIndex = null) {
      const modal = document.getElementById('viewPlaylistModal');
      document.getElementById('playlistViewTitle').textContent = `${icon} ${name}`;

      const content = document.getElementById('playlistViewContent');
      content.innerHTML = '';

      if (trackIds.length === 0) {
        content.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üéµ</div>
            <h3>No songs yet</h3>
            <p>Add songs to this playlist from the music cards</p>
          </div>
        `;
      } else {
        trackIds.forEach(trackId => {
          const track = musicData.find(t => t.id === trackId);
          if (track) {
            const item = document.createElement('div');
            item.className = 'playlist-item';
            item.innerHTML = `
              <div class="playlist-item-info">
                <div class="playlist-item-icon">${track.icon}</div>
                <div>
                  <div style="font-weight: 600;">${track.name}</div>
                  <div style="font-size: 12px; color: var(--text-secondary);">${track.artist}</div>
                </div>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn" onclick="playTrack(${track.id}); closeViewPlaylist();" style="padding: 6px 12px; font-size: 11px;">‚ñ∂Ô∏è Play</button>
                ${playlistIndex !== null ? `<button class="playlist-item-remove" onclick="removeFromPlaylist(${playlistIndex}, ${trackId})">Remove</button>` : ''}
              </div>
            `;
            content.appendChild(item);
          }
        });
      }

      modal.classList.add('active');
    }

    function closeViewPlaylist() {
      document.getElementById('viewPlaylistModal').classList.remove('active');
    }

    function removeFromPlaylist(playlistIndex, trackId) {
      const playlist = playlists[playlistIndex];
      playlist.tracks = playlist.tracks.filter(id => id !== trackId);
      saveData('playlists', playlists);

      showToast('Removed from playlist', 'info');
      renderPlaylists();
      viewPlaylistDetails(playlist.name, playlist.icon, playlist.tracks, playlistIndex);
    }

    function playTrack(trackId) {
      const track = musicData.find(t => t.id === trackId);
      if (!track) return;

      track.plays++;
      window.open(track.url, '_blank');
      showToast(`Now playing: ${track.name} üéµ`, 'success');

      stats.weekSessions++;
      stats.todayMinutes += 5;
      stats.totalMinutes += 5;
      saveData('stats', stats);
      updateStats();
    }

    function toggleFavorite(trackId) {
      if (favorites.includes(trackId)) {
        favorites = favorites.filter(id => id !== trackId);
        showToast('üíî Removed from favorites', 'info');
      } else {
        favorites.push(trackId);
        showToast('‚ù§Ô∏è Added to favorites', 'success');
      }
      saveData('favorites', favorites);
      renderMusic();
      renderFavorites();
    }

    function searchMusic() {
      currentFilters.search = document.getElementById('searchInput').value;
      renderMusic();
    }

    function filterByDuration(duration) {
      currentFilters.duration = duration;
      document.querySelectorAll('[data-duration]').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      renderMusic();
    }

    function filterByCategory(category) {
      currentFilters.category = category;
      document.querySelectorAll('[data-category]').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      renderMusic();
    }

    function toggleFAB() {
      const main = document.getElementById('fabMain');
      const actions = document.getElementById('fabActions');
      main.classList.toggle('active');
      actions.classList.toggle('active');
    }

    function exportData() {
      const exportData = {
        version: '1.0',
        exportDate: new Date().toISOString(),
        stats, favorites, playlists
      };

      const dataStr = JSON.stringify(exportData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `music-therapy-export-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showToast('Data exported successfully! üíæ', 'success');
    }

    function shareProgress() {
      const shareText = `üéµ My Music Therapy Progress:\n\nüî• ${stats.streak} day streak\n‚è±Ô∏è ${stats.totalMinutes} minutes of healing\nüéØ ${stats.weekSessions} sessions this week`;

      if (navigator.share) {
        navigator.share({ title: 'My Progress', text: shareText })
          .then(() => showToast('Progress shared! üì§', 'success'))
          .catch(() => {});
      } else {
        navigator.clipboard.writeText(shareText)
          .then(() => showToast('Progress copied! üìã', 'success'))
          .catch(() => showToast('Unable to share', 'error'));
      }
    }

    window.onload = init;
  </script>
</body>
</html>